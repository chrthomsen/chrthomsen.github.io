
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Data Sources &#8212; pygrametl 2.7 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dimensions" href="dimensions.html" />
    <link rel="prev" title="Database" href="database.html" />
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-30772056-2', 'auto');
  ga('send', 'pageview');
</script>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="data-sources">
<span id="datasources"></span><h1>Data Sources<a class="headerlink" href="#data-sources" title="Permalink to this headline">¶</a></h1>
<p>pygrametl supports numerous data sources, which are iterable classes that
produce rows. A row is a Python <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code> where the keys are the names of
the columns in the table where the row is from, and the values are the data
stored in that row. Users can easily implement new data sources by implementing
a version of the <code class="xref py py-meth docutils literal notranslate"><span class="pre">__iter__()</span></code> method that returns <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>. As data
source are iterable, they can, e.g., be used in a loop as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>While users can define their own data sources, pygrametl includes a number of
commonly used data sources:</p>
<section id="sqlsource">
<h2>SQLSource<a class="headerlink" href="#sqlsource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.SQLSource" title="pygrametl.datasources.SQLSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLSource</span></code></a> is a data source used to iterate over the results of a
single SQL query. The data source’s constructor must be passed a <span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0249"><strong>PEP 249</strong></a>
connection and not a <a class="reference internal" href="../api/pygrametl.html#pygrametl.ConnectionWrapper" title="pygrametl.ConnectionWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionWrapper</span></code></a>. As an example, a PostgreSQL
connection created using the psycopg2 package is used below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">SQLSource</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;dbuser&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;dbpass&#39;</span><span class="p">)</span>
<span class="n">sqlSource</span> <span class="o">=</span> <span class="n">SQLSource</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;SELECT * FROM table&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, an <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.SQLSource" title="pygrametl.datasources.SQLSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLSource</span></code></a> is created in order to extract all
rows from the table named table.</p>
<p>A tuple of strings can also optionally be supplied as the parameter <code class="xref py py-attr docutils literal notranslate"><span class="pre">names</span></code>, to
automatically rename the elements in the query results. Naturally, the number of
supplied names must match the number of elements in the result:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">SQLSource</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;dbuser&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;dbpass&#39;</span><span class="p">)</span>
<span class="n">sqlSource</span> <span class="o">=</span> <span class="n">SQLSource</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;SELECT * FROM table&#39;</span><span class="p">,</span>
                      <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.SQLSource" title="pygrametl.datasources.SQLSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLSource</span></code></a> also makes it possible to supply an SQL expression that will
be executed before the query, through the <code class="xref py py-attr docutils literal notranslate"><span class="pre">initsql</span></code> parameter. The result
of the expression will not be returned. In the example below a new view is
created and then used in the query:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">SQLSource</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;dbuser&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;dbpass&#39;</span><span class="p">)</span>
<span class="n">sqlSource</span> <span class="o">=</span> <span class="n">SQLSource</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;SELECT * FROM view&#39;</span><span class="p">,</span>
    <span class="n">initsql</span><span class="o">=</span><span class="s1">&#39;CREATE VIEW view AS SELECT id, name FROM table WHERE price &gt; 10&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="csvsource">
<h2>CSVSource<a class="headerlink" href="#csvsource" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">CSVSource</span></code> is a data source that returns a row for each line in a
character-separated file. It is an alias for Python’s <a class="reference external" href="http://docs.python.org/3/library/csv.html#csv.DictReader">csv.DictReader</a> as it already is
iterable and returns <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>. An example of how to use
<code class="xref py py-class docutils literal notranslate"><span class="pre">CSVSource</span></code> to read a file containing comma-separated values is shown
below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span>

<span class="c1"># ResultsFile.csv contains: name,age,score</span>
<span class="n">csvSource</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;ResultsFile.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, a <code class="xref py py-class docutils literal notranslate"><span class="pre">CSVSource</span></code> is initialized with a file handler
that uses a buffer size of 16384, This particular buffer size is used as it
performed better than the alternatives we evaluated it against.</p>
</section>
<section id="typedcsvsource">
<h2>TypedCSVSource<a class="headerlink" href="#typedcsvsource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.TypedCSVSource" title="pygrametl.datasources.TypedCSVSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypedCSVSource</span></code></a> extends <code class="xref py py-class docutils literal notranslate"><span class="pre">CSVSource</span></code> with typecasting by
wrapping <a class="reference external" href="http://docs.python.org/3/library/csv.html#csv.DictReader">csv.DictReader</a> instead of simply
being an alias.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">TypedCSVSource</span>

<span class="c1"># ResultsFile.csv contains: name,age,score</span>
<span class="n">typedCSVSource</span> <span class="o">=</span> <span class="n">TypedCSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;ResultsFile.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span>
                                <span class="n">casts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">},</span>
                                <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, a <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.TypedCSVSource" title="pygrametl.datasources.TypedCSVSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypedCSVSource</span></code></a> is initialized with a file
handler that uses a buffer size of 16384. This particular buffer size is used as
it performed better than the alternatives we evaluated it against. A dictionary
is also passed which provides information about what type each column should be
cast to. A cast is not performed for the name column as <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.TypedCSVSource" title="pygrametl.datasources.TypedCSVSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypedCSVSource</span></code></a>
uses <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code> as the default.</p>
</section>
<section id="pandassource">
<h2>PandasSource<a class="headerlink" href="#pandassource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.PandasSource" title="pygrametl.datasources.PandasSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">PandasSource</span></code></a> wraps a Pandas DataFrame so it can be used as a data
source. The class reuses existing functionality provided by <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/frame.html">DataFrame</a>. An
example of how to use this class can be seen below. In this example data is
loaded from a spreadsheet, then transformed using a Pandas DataFrame, and last
converted to an iterable that produce <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code> for use with pygrametl:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">PandasSource</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;Revenue.xls&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="mf">7.46</span><span class="p">)</span>
<span class="n">pandasSource</span> <span class="o">=</span> <span class="n">PandasSource</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, a Pandas DataFrame is created from a spreadsheet
containing revenue from some form of sales. Afterwards the data of the price
column is transformed using one of the higher-order functions built into the
Pandas package. Last, so the data can be loaded into a data warehouse using
pygrametl, a <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.PandasSource" title="pygrametl.datasources.PandasSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">PandasSource</span></code></a> is created with the DataFrame as an
argument, making the rows of the DataFrame accessible through a data source.</p>
</section>
<section id="mergejoiningsource">
<h2>MergeJoiningSource<a class="headerlink" href="#mergejoiningsource" title="Permalink to this headline">¶</a></h2>
<p>In addition to the above data sources which reads data from external sources,
pygrametl also includes a number of data sources that take other data sources as
input to transform and/or combine them.</p>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.MergeJoiningSource" title="pygrametl.datasources.MergeJoiningSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">MergeJoiningSource</span></code></a> can be used to equijoin the rows from two data
sources. The rows of the two data sources must be delivered in sorted order. The
shared attributes on which the rows are to be joined must also be given.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">MergeJoiningSource</span>

<span class="n">products</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;products.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">sales</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">mergeJoiningSource</span> <span class="o">=</span> <span class="n">MergeJoiningSource</span><span class="p">(</span><span class="n">src1</span><span class="o">=</span><span class="n">products</span><span class="p">,</span> <span class="n">key1</span><span class="o">=</span><span class="s1">&#39;productid&#39;</span><span class="p">,</span>
                                        <span class="n">src2</span><span class="o">=</span><span class="n">sales</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="s1">&#39;productid&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, a <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.MergeJoiningSource" title="pygrametl.datasources.MergeJoiningSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">MergeJoiningSource</span></code></a> is used to join two data
sources on their shared attribute productid.</p>
</section>
<section id="hashjoiningsource">
<h2>HashJoiningSource<a class="headerlink" href="#hashjoiningsource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.HashJoiningSource" title="pygrametl.datasources.HashJoiningSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">HashJoiningSource</span></code></a> functions similarly to <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.MergeJoiningSource" title="pygrametl.datasources.MergeJoiningSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">MergeJoiningSource</span></code></a>,
but it performs the join using a hash map. Thus the two input data sources need
not produce their rows in sorted order.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">HashJoiningSource</span>

<span class="n">products</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;products.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">sales</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">hashJoiningSource</span> <span class="o">=</span> <span class="n">HashJoiningSource</span><span class="p">(</span><span class="n">src1</span><span class="o">=</span><span class="n">products</span><span class="p">,</span> <span class="n">key1</span><span class="o">=</span><span class="s1">&#39;productid&#39;</span><span class="p">,</span>
                                      <span class="n">src2</span><span class="o">=</span><span class="n">sales</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="s1">&#39;productid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="unionsource">
<h2>UnionSource<a class="headerlink" href="#unionsource" title="Permalink to this headline">¶</a></h2>
<p>The class <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.UnionSource" title="pygrametl.datasources.UnionSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnionSource</span></code></a> creates a union of a number of the supplied data
sources. <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.UnionSource" title="pygrametl.datasources.UnionSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnionSource</span></code></a> does not require that the input data sources all
produce rows containing the same attributes, which also means that an
<a class="reference internal" href="../api/datasources.html#pygrametl.datasources.UnionSource" title="pygrametl.datasources.UnionSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnionSource</span></code></a> does not guarantee that all of the rows it produces
contain the same attributes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">UnionSource</span>

<span class="n">salesOne</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales1.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">salesTwo</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales2.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">salesThree</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales3.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">combinedSales</span> <span class="o">=</span> <span class="n">UnionSource</span><span class="p">(</span><span class="n">salesOne</span><span class="p">,</span> <span class="n">salesTwo</span><span class="p">,</span> <span class="n">salesThree</span><span class="p">)</span>
</pre></div>
</div>
<p>Each data source are exhausted before the next data source is read. This means
that all rows are read from the first data source before any rows are read from
the second data source, and so on.</p>
</section>
<section id="roundrobinsource">
<h2>RoundRobinSource<a class="headerlink" href="#roundrobinsource" title="Permalink to this headline">¶</a></h2>
<p>It can also be beneficial to interleave rows, and for this purpose,
<a class="reference internal" href="../api/datasources.html#pygrametl.datasources.RoundRobinSource" title="pygrametl.datasources.RoundRobinSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">RoundRobinSource</span></code></a> can be used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">RoundRobinSource</span>

<span class="n">salesOne</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales1.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">salesTwo</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales2.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">salesThree</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales3.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">combinedSales</span> <span class="o">=</span> <span class="n">RoundRobinSource</span><span class="p">((</span><span class="n">salesOne</span><span class="p">,</span> <span class="n">salesTwo</span><span class="p">,</span> <span class="n">salesThree</span><span class="p">),</span>
                                 <span class="n">batchsize</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.RoundRobinSource" title="pygrametl.datasources.RoundRobinSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">RoundRobinSource</span></code></a> is given a number of data
sources, and the argument <code class="xref py py-attr docutils literal notranslate"><span class="pre">batchsize</span></code>, which are the number of rows to be
read from one data source before reading from the next in a round-robin fashion.</p>
</section>
<section id="processsource">
<h2>ProcessSource<a class="headerlink" href="#processsource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.ProcessSource" title="pygrametl.datasources.ProcessSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessSource</span></code></a> is used for iterating over a data source using a
separate worker process or thread. The worker reads data from the input data
source and creates batches of rows. When a batch is complete, it is added to a
queue so it can be consumed by another process or thread. If the queue is full
the worker blocks until an element is removed from the queue. The sizes of the
batches and the queue are optional parameters, but tuning them can often improve
throughput. For more examples of the parallel features provided by pygrametl see
<a class="reference internal" href="parallel.html"><span class="doc">Parallel</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">ProcessSource</span>

<span class="n">sales</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">processSource</span> <span class="o">=</span> <span class="n">ProcessSource</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">sales</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">queuesize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="filteringsource">
<h2>FilteringSource<a class="headerlink" href="#filteringsource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.FilteringSource" title="pygrametl.datasources.FilteringSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilteringSource</span></code></a> is used to apply a filter to a data source. By
default, the built-in Python function <a class="reference external" href="http://docs.python.org/3/library/functions.html#bool">bool</a> is used, which can be
used to remove empty rows. Alternatively, the user can supply a custom filter
function, which should be a callable function <code class="xref py py-attr docutils literal notranslate"><span class="pre">f(row)</span></code>, which returns
<code class="xref py py-attr docutils literal notranslate"><span class="pre">True</span></code> when a row should be passed on. In the example below, rows are
removed if the value of their location attribute is not Aalborg.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">FilteringSource</span>


<span class="k">def</span> <span class="nf">locationfilter</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Aalborg&#39;</span>


<span class="n">sales</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">salesFiltered</span> <span class="o">=</span> <span class="n">FilteringSource</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">sales</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">locationfilter</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mappingsource">
<h2>MappingSource<a class="headerlink" href="#mappingsource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.MappingSource" title="pygrametl.datasources.MappingSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingSource</span></code></a> can be used to apply functions to the columns of a data
source. It can be given a dictionary that where the keys are the columns and the
values are callable functions of the form <code class="xref py py-attr docutils literal notranslate"><span class="pre">f(val)</span></code>. The functions will be
applied to the attributes in an undefined order. In the example below, a
function is used to cast all values for the attribute price to integers while
rows are being read from a CSV file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">MappingSource</span>

<span class="n">sales</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">salesMapped</span> <span class="o">=</span> <span class="n">MappingSource</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">sales</span><span class="p">,</span> <span class="n">callables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="transformingsource">
<h2>TransformingSource<a class="headerlink" href="#transformingsource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.TransformingSource" title="pygrametl.datasources.TransformingSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransformingSource</span></code></a> can be used to apply functions to the rows of a
data source. The class can be supplied with a number of callable functions of
the form <code class="xref py py-attr docutils literal notranslate"><span class="pre">f(row)</span></code>, which will be applied to the source in the given order.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pygrametl</span>
<span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">TransformingSource</span>


<span class="k">def</span> <span class="nf">dkk_to_eur</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">price_as_a_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;dkk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price_as_a_number</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;eur&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price_as_a_number</span> <span class="o">/</span> <span class="mf">7.43</span>


<span class="n">sales</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">salesTransformed</span> <span class="o">=</span> <span class="n">TransformingSource</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">dkk_to_eur</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, the price is converted from a string to an integer and
stored in the row as two currencies.</p>
</section>
<section id="crosstabbingsource">
<h2>CrossTabbingSource<a class="headerlink" href="#crosstabbingsource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.CrossTabbingSource" title="pygrametl.datasources.CrossTabbingSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">CrossTabbingSource</span></code></a> can be used to compute the cross tab of a data
source. The class takes as parameters the names of the attributes that are to
appear as rows and columns in the crosstab, as well as the name of the attribute
to aggregate. By default, the values are aggregated using
<a class="reference internal" href="../api/aggregators.html#pygrametl.aggregators.Sum" title="pygrametl.aggregators.Sum"><code class="xref py py-class docutils literal notranslate"><span class="pre">pygrametl.aggregators.Sum</span></code></a>, but the class also accepts an alternate
aggregator from the module <a class="reference internal" href="../api/aggregators.html#module-pygrametl.aggregators" title="pygrametl.aggregators"><code class="xref py py-class docutils literal notranslate"><span class="pre">pygrametl.aggregators</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">CrossTabbingSource</span><span class="p">,</span> \
    <span class="n">TransformingSource</span>
<span class="kn">from</span> <span class="nn">pygrametl.aggregators</span> <span class="kn">import</span> <span class="n">Avg</span>


<span class="k">def</span> <span class="nf">dkk_to_eur</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">price_as_a_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;dkk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price_as_a_number</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;eur&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price_as_a_number</span> <span class="o">/</span> <span class="mf">7.43</span>


<span class="n">sales</span> <span class="o">=</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sales.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">salesTransformed</span> <span class="o">=</span> <span class="n">TransformingSource</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">dkk_to_eur</span><span class="p">)</span>

<span class="n">crossTab</span> <span class="o">=</span> <span class="n">CrossTabbingSource</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">salesTransformed</span><span class="p">,</span> <span class="n">rowvaluesatt</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span>
                              <span class="n">colvaluesatt</span><span class="o">=</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;eur&#39;</span><span class="p">,</span>
                              <span class="n">aggregator</span><span class="o">=</span><span class="n">Avg</span><span class="p">())</span>
</pre></div>
</div>
<p>In the above example, a crosstab is made from a table containing sales data in
order to view the average price of products across different locations.
<a class="reference internal" href="../api/datasources.html#pygrametl.datasources.TransformingSource" title="pygrametl.datasources.TransformingSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransformingSource</span></code></a> is used to parse and convert the price from DKK to EUR.</p>
</section>
<section id="dynamicforeachsource">
<h2>DynamicForEachSource<a class="headerlink" href="#dynamicforeachsource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/datasources.html#pygrametl.datasources.DynamicForEachSource" title="pygrametl.datasources.DynamicForEachSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicForEachSource</span></code></a> is a data source that for each data source
provided as input, creates a new data source that will be iterated by the
<a class="reference internal" href="../api/datasources.html#pygrametl.datasources.DynamicForEachSource" title="pygrametl.datasources.DynamicForEachSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicForEachSource</span></code></a> data source. To create the new data sources the
user must provide a function that when called with a single argument, return a
new data source. In the example below, <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.DynamicForEachSource" title="pygrametl.datasources.DynamicForEachSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicForEachSource</span></code></a> is used to
create a <code class="xref py py-class docutils literal notranslate"><span class="pre">CSVSource</span></code> for each of the CSV files in a directory. The
<a class="reference internal" href="../api/datasources.html#pygrametl.datasources.DynamicForEachSource" title="pygrametl.datasources.DynamicForEachSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicForEachSource</span></code></a> stores the input list in a safe multiprocessing
queue, and as such the <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.DynamicForEachSource" title="pygrametl.datasources.DynamicForEachSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicForEachSource</span></code></a> instance can be given to
several <a class="reference internal" href="../api/datasources.html#pygrametl.datasources.ProcessSource" title="pygrametl.datasources.ProcessSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessSource</span></code></a>. For information about pygrametl’s parallel
features see <a class="reference internal" href="parallel.html"><span class="doc">Parallel</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">pygrametl.datasources</span> <span class="kn">import</span> <span class="n">CSVSource</span><span class="p">,</span> <span class="n">DynamicForEachSource</span>


<span class="k">def</span> <span class="nf">createCSVSource</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">CSVSource</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">16384</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>


<span class="n">salesFiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;sales/*.csv&#39;</span><span class="p">)</span>
<span class="n">combinedSales</span> <span class="o">=</span> <span class="n">DynamicForEachSource</span><span class="p">(</span><span class="n">seq</span><span class="o">=</span><span class="n">salesFiles</span><span class="p">,</span> <span class="n">callee</span><span class="o">=</span><span class="n">createCSVSource</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pygrametl</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/install.html">Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/beginner.html">Beginner Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="dimensions.html">Dimensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="facttables.html">Fact Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="bulkloading.html">Bulk Loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallel.html">Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="jython.html">Jython</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/pygrametl.html">pygrametl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/datasources.html">datasources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/tables.html">tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/parallel.html">parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/jdbcconnectionwrapper.html">JDBCConnectionWrapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/jythonmultiprocessing.html">jythonmultiprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/aggregators.html">aggregators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/steps.html">steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/fifodict.html">FIFODict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/drawntabletesting.html">drawntabletesting</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="database.html" title="previous chapter">Database</a></li>
      <li>Next: <a href="dimensions.html" title="next chapter">Dimensions</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2009 - 2021, Aalborg University.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/examples/datasources.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>